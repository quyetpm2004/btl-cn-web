//////////////////////////////////////////////////////////////
// ðŸ”¹ 1. QUáº¢N LÃ NGÆ¯á»œI DÃ™NG & PHÃ‚N QUYá»€N
//////////////////////////////////////////////////////////////
Table roles {
  id int [pk, increment]
  name varchar                    // Admin, CÆ° dÃ¢n, Thu ngÃ¢n, Ká»¹ thuáº­t...
  description text
}

Table users {
  id int [pk, increment]
  username varchar [not null, unique]
  password varchar [not null]
  role_id int [ref: > roles.id]
  email varchar
  phone varchar
  avatar_url varchar
  status tinyint [default: 1]     // 0:'inactive', 1:'active'
  created_at timestamp
  updated_at timestamp
}

Table staffs {
  id int [pk, increment]
  user_id int [ref: > users.id]
  full_name varchar
  dob date
  gender tinyint                  // 1:nam, 2:ná»¯, 3:khÃ¡c
  position varchar
  department varchar
  id_card varchar
  address varchar
  start_date date
  salary int
  status tinyint [default: 1]     // 0:'nghá»‰', 1:'Ä‘ang lÃ m', 2:'nghá»‰ phÃ©p'
}

//////////////////////////////////////////////////////////////
// ðŸ”¹ 2. CÆ¯ DÃ‚N, CÄ‚N Há»˜ & XE
//////////////////////////////////////////////////////////////
Table apartment_types {
  id int [pk, increment]
  name varchar                    // Studio, 1PN, 2PN...
  description text
  layout_image varchar
}

Table apartments {
  id int [pk, increment]
  apartment_code varchar [unique] // A101
  building varchar                // S1
  type_id int [ref: > apartment_types.id]
  area float
  floor int
  status tinyint                  // 0:'Trá»‘ng', 1:'Äang á»Ÿ'
  
  // [NEW] VÃ­ tiá»n thá»«a cá»§a cÄƒn há»™ (dÃ¹ng Ä‘á»ƒ cáº¥n trá»« tá»± Ä‘á»™ng thÃ¡ng sau)
  excess_balance bigint [default: 0] 
}

Table residents {
  id int [pk, increment]
  user_id int [ref: > users.id]   // Link tÃ i khoáº£n (Ä‘á»ƒ login App)
  full_name varchar
  gender tinyint
  phone varchar
  dob date
  id_card varchar [unique]
  hometown varchar
  status tinyint [default: 1]     // 1:'Ä‘ang á»Ÿ', 2:'táº¡m váº¯ng', 3:'chuyá»ƒn Ä‘i'
  registered_at timestamp
}

Table resident_apartment {
  id int [pk, increment]
  resident_id int [ref: > residents.id]
  apartment_id int [ref: > apartments.id]
  
  // Quan trá»ng: PhÃ¢n biá»‡t Chá»§ sá»Ÿ há»¯u vÃ  NgÆ°á»i á»Ÿ
  relationship varchar            // 'OWNER', 'TENANT' (thuÃª), 'MEMBER' (thÃ nh viÃªn)
  is_living boolean [default: 1]  // TRUE: Äang á»Ÿ, FALSE: Chá»‰ sá»Ÿ há»¯u/Ä‘á»©ng tÃªn
  
  start_date date
  end_date date                   // Náº¿u chuyá»ƒn Ä‘i thÃ¬ update ngÃ y nÃ y
}

Table vehicles {
  id int [pk, increment]
  apartment_id int [ref: > apartments.id]
  type tinyint                    // 1:'car', 2:'motorbike', 3:'bicycle'
  brand varchar
  license_plate varchar [unique]
  color varchar
  status tinyint [default: 1]
}

//////////////////////////////////////////////////////////////
// ðŸ”¹ 3. Dá»ŠCH Vá»¤ & CHá»T Sá» (INPUT Dá»® LIá»†U)
//////////////////////////////////////////////////////////////
Table services {
  id int [pk, increment]
  name varchar                    // PhÃ­ quáº£n lÃ½, Gá»­i xe, Äiá»‡n, NÆ°á»›c
  type tinyint                    // 0: Cá»‘ Ä‘á»‹nh (Fixed), 1: Theo chá»‰ sá»‘ (Metered)
  price int                       // ÄÆ¡n giÃ¡
  unit varchar                    // thÃ¡ng, kwh, m3
  description text
}

// [NEW] Báº£ng lÆ°u chá»‰ sá»‘ Äiá»‡n/NÆ°á»›c hÃ ng thÃ¡ng
Table meter_readings {
  id int [pk, increment]
  apartment_id int [ref: > apartments.id]
  service_id int [ref: > services.id]      // Dá»‹ch vá»¥: Äiá»‡n hoáº·c NÆ°á»›c
  period_id int [ref: > collection_periods.id]
  
  old_index int                            // Chá»‰ sá»‘ cÅ©
  new_index int                            // Chá»‰ sá»‘ má»›i
  amount int                               // Sá»‘ tiÃªu thá»¥ = new - old
  image_url varchar                        // áº¢nh chá»¥p cÃ´ng tÆ¡
  
  created_at timestamp
  created_by int [ref: > users.id]
}

Table service_registrations {
  id int [pk, increment]
  apartment_id int [ref: > apartments.id]
  service_id int [ref: > services.id]
  vehicle_id int [ref: > vehicles.id, null] // Náº¿u lÃ  gá»­i xe thÃ¬ link vÃ o Ä‘Ã¢y
  start_date date
  end_date date
  status tinyint [default: 1]
}

//////////////////////////////////////////////////////////////
// ðŸ”¹ 4. TÃ€I CHÃNH (HÃ“A ÄÆ N & THANH TOÃN)
//////////////////////////////////////////////////////////////
Table collection_periods {
  id int [pk, increment]
  name varchar                    // "Thu phÃ­ thÃ¡ng 11/2024"
  start_date date
  end_date date
  status tinyint [default: 1]     // 1:'active', 0:'closed'
}

Table invoices {
  id int [pk, increment]
  apartment_id int [ref: > apartments.id]
  period_id int [ref: > collection_periods.id]
  
  total_amount bigint             // Tá»•ng tiá»n pháº£i thu
  payment_deadline date           // Háº¡n chÃ³t
  
  status tinyint [default: 0]     // 0:'Unpaid', 1:'Paid', 2:'Cancelled'
  created_at timestamp
  created_by int [ref: > users.id]
  note text
}

Table invoice_items {
  id int [pk, increment]
  invoice_id int [ref: > invoices.id]
  service_id int [ref: > services.id]
  
  title varchar                   // "Tiá»n Ä‘iá»‡n (100 - 150)"
  quantity int                    // Sá»‘ lÆ°á»£ng / Sá»‘ tiÃªu thá»¥
  unit_price int                  // ÄÆ¡n giÃ¡ lÃºc tÃ­nh
  amount int                      // ThÃ nh tiá»n
}

Table payments {
  id int [pk, increment]
  invoice_id int [ref: > invoices.id]
  resident_id int [ref: > residents.id]   // NgÆ°á»i thao tÃ¡c thanh toÃ¡n
  
  amount bigint                           // Sá»‘ tiá»n thá»±c táº¿ chuyá»ƒn
  method varchar                          // BANK_TRANSFER, QR_CODE
  transaction_code varchar                // MÃ£ tham chiáº¿u ngÃ¢n hÃ ng
  paid_at timestamp
  
  status tinyint [default: 1]             // 1: Success, 2: Refund_Needed (Ná»™p thá»«a/trÃ¹ng)
}

// [NEW] Báº£ng lá»‹ch sá»­ tiá»n thá»«a (Thay cho vÃ­)
Table excess_transactions {
  id int [pk, increment]
  apartment_id int [ref: > apartments.id]
  
  amount bigint                           // Sá»‘ tiá»n (+ hoáº·c -)
  type tinyint                            // 1: Ná»™p thá»«a (Overpayment), 2: Trá»« tá»± Ä‘á»™ng (Auto-deduct)
  
  payment_id int [ref: > payments.id, null] // Link náº¿u type=1 (Ná»™p thá»«a tá»« Payment nÃ o)
  invoice_id int [ref: > invoices.id, null] // Link náº¿u type=2 (Trá»« tiá»n cho Invoice nÃ o)
  
  description text                        // "Thá»«a tá»« GD #123", "Trá»« cho HD T12"
  created_at timestamp
}

//////////////////////////////////////////////////////////////
// ðŸ”¹ 5. THIáº¾T Bá»Š & Báº¢O TRÃŒ (Giá»¯ nguyÃªn)
//////////////////////////////////////////////////////////////
Table equipments {
  id int [pk, increment]
  name varchar
  location varchar
  status tinyint [default: 1]     // 0:inactive, 1:active, 2:maintenance, 3:broken
  last_maintenance timestamp
}

Table work_types {
  id int [pk, increment]
  name varchar                    // Äiá»‡n, NÆ°á»›c, XÃ¢y dá»±ng...
  description text
}

Table maintenance_requests {
  id int [pk, increment]
  resident_id int [ref: > residents.id]
  title varchar
  description text
  priority tinyint                // 1:low -> 4:urgent
  status tinyint [default: 0]     // 0:pending, 1:processing, 2:done, 3:cancelled
  
  assigned_to int [ref: > staffs.id]
  work_type_id int [ref: > work_types.id]
  
  images json
  result text
  created_at timestamp
  resolved_at timestamp
}

Table maintenance_schedules {
  id int [pk, increment]
  equipment_id int [ref: > equipments.id]
  assigned_to int [ref: > staffs.id]
  start_at timestamp
  end_at timestamp
  description text
  status tinyint
}

//////////////////////////////////////////////////////////////
// ðŸ”¹ 6. THÃ”NG BÃO & TIN Tá»¨C (Giá»¯ nguyÃªn logic)
//////////////////////////////////////////////////////////////
Table notifications {
  id int [pk, increment]
  title varchar
  content text
  category tinyint                // 1:System, 2:Event, 3:Fee, 4:Maintenance
  created_at timestamp
  created_by int [ref: > users.id]
}

Table notification_receivers {
  id int [pk, increment]
  notification_id int [ref: > notifications.id]
  resident_id int [ref: > residents.id]
  is_read boolean [default: 0]
  read_at timestamp
}

Table news {
  id int [pk, increment]
  title varchar
  content text
  category int                    // Event, News, Guide
  created_at timestamp
}

//////////////////////////////////////////////////////////////
// ðŸ”¹ 7. TIá»†N ÃCH KHÃC
//////////////////////////////////////////////////////////////
Table contacts {
  id int [pk, increment]
  email varchar
  phone varchar
  address varchar
  map_embed_url text
}

Table financial_reports {
  id int [pk, increment]
  period_id int [ref: > collection_periods.id]
  total_income bigint
  total_expense bigint
  created_at timestamp
}